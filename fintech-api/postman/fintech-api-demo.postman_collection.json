{
  "info": {
    "_postman_id": "4dfe3be8-cf4d-4df2-a126-5e1f6f0ebf3d",
    "name": "Fintech API Demo",
    "description": "Postman collection for the fintech-api-demo teaching project. Demonstrates auth, idempotent payments, ledger checks, and audit verification.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{apiToken}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "1) Health",
      "item": [
        {
          "name": "GET /health (public)",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "health"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "2) Customers",
      "item": [
        {
          "name": "GET /v1/customers",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/customers",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "customers"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /v1/customers",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Student Demo {{$timestamp}}\",\n  \"country\": \"US\",\n  \"documentReference\": \"DOC-DEMO-001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/v1/customers",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "customers"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});",
                  "const data = pm.response.json();",
                  "if (data && data.customer && data.customer.id) {",
                  "  pm.collectionVariables.set('customerId', data.customer.id);",
                  "}"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "3) Accounts",
      "item": [
        {
          "name": "GET /v1/accounts",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/accounts",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "accounts"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});",
                  "const data = pm.response.json();",
                  "const accounts = (data && data.accounts) || [];",
                  "const source = accounts.find((a) => String(a.id).includes('alice')) || accounts[0];",
                  "const destination = accounts.find((a) => String(a.id).includes('bob')) || accounts[1];",
                  "if (source && source.id) pm.collectionVariables.set('sourceAccountId', source.id);",
                  "if (destination && destination.id) pm.collectionVariables.set('destinationAccountId', destination.id);"
                ]
              }
            }
          ]
        },
        {
          "name": "POST /v1/accounts",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"customerId\": \"{{customerId}}\",\n  \"currency\": \"USD\",\n  \"initialBalanceCents\": 25000\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/v1/accounts",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "accounts"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 201', function () {",
                  "  pm.response.to.have.status(201);",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /v1/accounts/:id/balance (source)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/accounts/{{sourceAccountId}}/balance",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "accounts",
                "{{sourceAccountId}}",
                "balance"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "4) Payments",
      "item": [
        {
          "name": "POST /v1/payments (create idempotent payment)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (!pm.collectionVariables.get('idempotencyKey')) {",
                  "  pm.collectionVariables.set('idempotencyKey', 'demo-' + Date.now());",
                  "}"
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 201 or 202 or 422', function () {",
                  "  pm.expect([201, 202, 422]).to.include(pm.response.code);",
                  "});",
                  "const data = pm.response.json();",
                  "if (data && data.payment && data.payment.id) {",
                  "  pm.collectionVariables.set('paymentId', data.payment.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{idempotencyKey}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sourceAccountId\": \"{{sourceAccountId}}\",\n  \"destinationAccountId\": \"{{destinationAccountId}}\",\n  \"amountCents\": 12000,\n  \"currency\": \"USD\",\n  \"note\": \"Invoice #1001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/v1/payments",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "payments"
              ]
            }
          }
        },
        {
          "name": "POST /v1/payments (replay same request)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Idempotency-Key",
                "value": "{{idempotencyKey}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sourceAccountId\": \"{{sourceAccountId}}\",\n  \"destinationAccountId\": \"{{destinationAccountId}}\",\n  \"amountCents\": 12000,\n  \"currency\": \"USD\",\n  \"note\": \"Invoice #1001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/v1/payments",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "payments"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('idempotency replay header is true', function () {",
                  "  pm.expect(pm.response.headers.get('Idempotency-Replayed')).to.eql('true');",
                  "});"
                ]
              }
            }
          ]
        },
        {
          "name": "GET /v1/payments/:id",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/payments/{{paymentId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "payments",
                "{{paymentId}}"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('status is 200', function () {",
                  "  pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    },
    {
      "name": "5) Ledger + Audit",
      "item": [
        {
          "name": "GET /v1/ledger",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/ledger",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "ledger"
              ]
            }
          }
        },
        {
          "name": "GET /v1/audit-logs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/audit-logs?limit=50",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "audit-logs"
              ],
              "query": [
                {
                  "key": "limit",
                  "value": "50"
                }
              ]
            }
          }
        },
        {
          "name": "GET /v1/audit-logs/verify",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/v1/audit-logs/verify",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "v1",
                "audit-logs",
                "verify"
              ]
            }
          },
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('audit chain valid', function () {",
                  "  pm.response.to.have.status(200);",
                  "  const data = pm.response.json();",
                  "  pm.expect(data.verification.valid).to.eql(true);",
                  "});"
                ]
              }
            }
          ]
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:3000"
    },
    {
      "key": "apiToken",
      "value": "demo-fintech-token"
    },
    {
      "key": "sourceAccountId",
      "value": "acc_demo_alice_usd"
    },
    {
      "key": "destinationAccountId",
      "value": "acc_demo_bob_usd"
    },
    {
      "key": "customerId",
      "value": ""
    },
    {
      "key": "paymentId",
      "value": ""
    },
    {
      "key": "idempotencyKey",
      "value": ""
    }
  ]
}
